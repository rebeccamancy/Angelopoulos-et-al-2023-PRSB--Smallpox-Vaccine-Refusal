# Angelopoulos-et-al-2023-PRSB--Smallpox-Vaccine-Refusal
This README explains the pipeline and running of files for the manuscript.

Angelopoulos, K., Stewart, G. and Mancy, R. Local infectious disease experience influences vaccine refusal rates: a natural experiment. Proceedings of the Royal Society B: Biological Sciences. DOI: 10.1098/rspb.2022.1986.

A release of this repository is provided as DOI: 10.5281/zenodo.7551763 (see https://zenodo.org/badge/latestdoi/590951636).

The overall approach is that the initial pipeline pulls together data sources in raw_data to generate the final dataset, in a form that is amenable to analysis. The remainder of the files serve to conduct the statistical analysis (Results_XXX), generate tables (Table_XXX), and generate figures (Fig_XXX). Note that files generating tables and figures do not carry out additional analysis, but instead read in output generated by the Results_XXX files and saved to the folder Output_data. Therefore, the statistical analysis files for the underpinning results need to be run prior to running the code for the tables or figures.

Note that, as shared, the folders 'figs' and 'tables' are missing from the repository and need to be recreated for the code to run. This is because the folders are empty and are thus not included; the contents are generated by the running of the scripts.

## Folder structure
Scripts are included at the root. The folder 'raw_data' contains the raw, manually entered data directly from the sources. The folder 'Output_data' contains the processed data required to conduct the statistical analysis in the manuscript and online supplementary material, which is generated from the raw data using the scripts in the repository. The folder 'R' contains functions. The folder 'shp' contains shapefiles which are identical to the following and should be cited using this reference:

Mancy, Rebecca. (2023). Shapefiles of administrative boundaries, Subway and main rivers in Glasgow, UK, around 1910 (1.0.0) [Data set]. Zenodo. https://doi.org/10.5281/zenodo.7550897

Additional information regarding the construction of these shapefiles is provided as part of the Zenodo record and in Angelopoulos et al. (2023) (see reference above).

# Pipeline
Note that: SD = Sanitary Districts; RD = Registration Districts

## Data compilation step

### 1_Generate_Glasgow_Raster.R
This file takes separate geotiffs from Digimap (see paper for references) and uses these to create a raster of the relevant area of Glasgow. The information in the raster is used as a proxy for population density information for the conversion of certain variables from SDs to wards, and also from wards to RDs. For copyright reasons, the files required to run this script need to be obtained directly from Digimap using the references provided in the paper.

### 2_Generate_Polygon_Densities_Wards.R
This script runs through the polygons created by intersecting the ward and SD shapefiles and adds a proxy for population size for each as the sum of points from the Glasgow raster file. Version 2a does the same for wards and RDs.

### 3_Convert_SD_Wards_Pop_Density.R
This script creates a matrix that will be used to convert data from SDs to wards. File 3a does the same for wards and RDs.

### 4_Compile_COV_Panel_Wards.R
Converts output of the conversion in 3_Convert_SD_Wards_Pop_Density.R into panel format for statistical analysis. Also conducts translations of variables between geographies where required. File 4a undertakes the same conversion for wards to RDs.

### 5_Compute_Derived_Variables_Wards.R
Computes variables such as smallpox experience variables for 1900-1904. 

### 6_Combine_Datasets_For_Analysis.R
Combines ward and RD data into a single Excel spreadsheet for analysis.
This file is named COV_Main_Dataset.xslx and contains a data dictionary explaining the sheets and variables and separate worksheets as listed at the top of the file.

### 7_Compute_Descriptive_Stats
Computes and outputs files of descriptive statistics (of static variables and of COV by year) for wards. 7a undertakes the same calculations for RDs.

## Statistical analysis step

### Results_XXX scripts that carry out the model estimation
These are named to indicate the geography (wards or RD), model estimation (OLS or fracreg) and model specification. These scripts also combine output into a convenient form for making figures and tables and write this output to Output_data with filenames starting Results_.

## Tables and figures

### Table_XXX scripts construct tables for the main text and supplementary material
Output from the various models is transformed into tables. The output is saved to the folder tables with filenames starting Table_.

### Fig_XXX construct figures for main text and supplementary material
Creates figures for the main text. The output is saved to folder figs with filenames starting fig_. 
